# ChadGPT_Highload
Проектирование высоконагруженной большой языковой модели для генерации текста и ответов на вопросы

## Оглавление
1. [Тема и целевая аудитория](#1)
2. [Расчет нагрузки](#2)

## 1. Тема и целевая аудитория <a name="1"></a>

### Тема
Сервис ChatGPT – это большая языковая модель, обученная OpenAI, которая использует глубокое обучение для генерации текста и ответов на вопросы.
Данный сервис, у которого существенная часть логики приходится на бекенд, имеет конечного массового пользователя.

### Целевая аудитория
| Характеристика | Значение |
| :--- | :---: |
| Целевая аудитория | Всемировая |
| MAU [1] | 180,5M |
| DAU [2] | 13M |

Ниже представлена таблица, показывающая долю пользователей ChatGPT из разных стран:
| Страна | Процент пользователей ChatGPT |
| :--- | :---: |
| Соединенные Штаты	| 14,4% |
| Индия	| 6,9% |
| Колумбия | 3,56% |
| Филиппины | 3,49% |
| Япония | 2,96% |
| Другие страны | 68,69% |

### Функционал
- Обработка текстовых запросов пользователя для генерации текста
- Обработка текстовых запросов пользователя для генерации изображения

## 2. Расчет нагрузки <a name="2"></a>

### Продуктовые метрики

#### Расчет продуктовых метрик

В сутки ChatGPT получает 10M запросов [3] за 2023, за 2023 MAU = 100M [4], следовательно DAU2023 = 13M*100M/180,5M = 7,2M, значит в сутки ChatGPT получает 10M * 13M / 7,2M = 18,06M, из них 2M запросов на генерацию изображений [5], значит на генерацию текстов уходит 16,06M запросов в сутки. 

На данных момент максимальное количество символов в запросе ChatGPT составляет 2048 [6]. Для хранения текстов пользователя в чатах необходимо хранилище размера: 
```
(((2048*2) символов * 1/1024/1024/1024) Гб * 8_000_000) Гб/сутки * 30*12*3 / 13_000_000 = 0,0025 Гб ≈ 0,005 Гб
```

На данный момент размер генерируемого DALLE-изображения в среднем 1024x1024 пикселя [7] + сам запрос для генерации 1024 байта. Для хранения изображений в чатах необходимо хранилище размера: 
```
(((((1024*1024) пикселей * 24/8) байт + 2048 байт) байт /1024/1024/1024) Гб * 2_000_000) Гб/сутки * 30*12*3 / 13_000_000 = 0,49 Гб ≈ 1 Гб
```

Примерно раз в квартал будет переобучение модели – это 4 переобучения в год. Учитывая, что на обучение необходим набор данных размером 570 Гб [8], для обучение пригодить хранилище размером:
```
570 Гб * 4 * 3 = 6_840 Гб
```

Размер модели составляет 700 Гб [9] – это 9 видеокарт A100 (по 80 Гб)

#### Сводная таблица продуктовых метрик
| Характеристика | Метрика |
| :--- | :---: |
| MAU | 180,5M |
| DAU | 13M |
| Средний размер хранилища пользователя | 1,005 Гб |
| Средний размер хранилища для обучения | 6_840 Гб |
| Средний размер модели | 700 Гб |
| Среднее количество действий пользователя по генерации текста | 8 M/сутки |
| Среднее количество действий пользователя по генерации изображения | 2 M/сутки |

### Технические метрики

#### Расчет технических метрик

Для хранения текстов в чатах необходимо хранилище размера: 
```
(((2048*2) символов * 1/1024/1024/1024/1024) Тб * 8_000_000) Тб/сутки * 30*12*3 = 32,19 Тб ≈ 33 Тб
```

Для хранения изображений в чатах необходимо хранилище размера: 
```
(((((1024*1024) пикселей * 24/8) байт + 1024 байта)/1024/1024/1024/1024) Тб * 2_000_000) Тб/сутки * 30*12*3 = 6_182 Тб ≈ 6_200 Тб
```

Возьмем небольшой коэфицент k=1,5 отличия от среднего трафика для получения пикового трафика по генерации текста:
```
(((2048*2) символов * 8/1024/1024/1024) Гбит * 8_000_000 запросов/сутки) Гбит/сутки / 24/60/60 * 1,5 = 0,004 Гбит/с
```

Возьмем небольшой коэфицент k=1,5 отличия от среднего трафика для получения пикового трафика по генерации изображения:
```
(((((1024*1024) пикселей * 24) бит + 2048*8 бит)/1024/1024/1024) Гбит * 2_000_000 запросов/сутки) Гбит/сутки / 24/60/60 * 1,5 = 0,81 Гбит/с
```

Для получения суммарного суточного трафика по генерации текста:
```
(((2048*2) символов * 1024/1024/1024) Гбайт * 8_000_000 запросов/сутки) Гбайт/сутки = 30,518 Гбайт/сутки
```

Для получения суммарного суточного трафика по генерации изображения:
```
(((((1024*1024) пикселей * 24) бит + 2048*8 бит) /1024/1024/1024) Гбит * 2_000_000 запросов/сутки) Гбит/сутки = 46_906 Гбайт/сутки
```

RPS по генерации текста:
```
8_000_000 запросов/сутки / 24/60/60 = 92,6 запросов/с
```

RPS по генерации текста:
```
2_000_000 запросов/сутки / 24/60/60 = 23,15 запросов/с
```

#### Сводная таблица технических метрик

| Характеристика | Метрика |
| :--- | :---: |
| Размер хранения по генерации текста | 33 Тб |
| Размер хранения по генерации изображения | 6_200 Тб |
| Пиковое потребление в теченнии суток | 0,814 Гбит/с |
| Суммарный суточный |  46_936,512 Гбайт/сутки |
| RPS по генерации текста | 92,6 запросов/с |
| RPS по генерации изображения | 23,15 запросов/с |

## Источники

1. https://www.demandsage.com/chatgpt-statistics/#:~:text=chatbot%20has%20over-,180.5%20million%20MAUs,-.
2. https://artsmart.ai/blog/number-of-chatgpt-users/#:~:text=13%20million%20unique%20visitors%20used%20ChatGPT%20daily
3. https://www.mlyearning.org/chatgpt-statistics/#:~:text=ChatGPT%20receives%20approximately%2010%20million%20queries%20per%20day
4. https://explodingtopics.com/blog/chatgpt-users#:~:text=100%20million%20monthly%20active%20users
5. https://www.notta.ai/en/blog/chatgpt-statistics#:~:text=Users%20generate%20about%202%20million%20images%20every%20day%20using%20OpenAI%27s%20DALL.E%202
6. https://chatgptdetector.co/chatgpt-character-limit/#:~:text=Currently%2C%20the%20character%20limit%20for%20ChatGPT%20is%202048%20characters
7. https://tecnosoluciones.com/revolutionizing-visual-creation-how-to-create-images-using-chatgpt/?lang=en#:~:text=The%20maximum%20image%20dimensions%20that%20ChatGPT%20can%20create%2C%20specifically%20through%20tools%20like%20DALL%2DE%2C%20are%20generally%201024%C3%971024%20pixels%20for%20square%20images
8. https://teamtutorials.com/other-tutorials/how-big-is-chatgpt-dataset#:~:text=ChatGPT%20has%20been%20trained%20on%20a%20dataset%20that%20contains%20over%20570GB%20of%20text%20data
9. https://www.codetd.com/ru/article/16382788#:~:text=%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D1%8F%D0%B5%D1%82%20%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE%20%D0%B2%D1%8B%D0%B2%D0%BE%D0%B4%2C-,%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C%20%D0%B2%20%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D0%B5%20%D0%BE%D0%B6%D0%B8%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B7%D0%B0%D0%BD%D0%B8%D0%BC%D0%B0%D0%B5%D1%82%20%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%20700%20%D0%93%D0%91%20%D0%B8%20%D1%82%D1%80%D0%B5%D0%B1%D1%83%D0%B5%D1%82%20%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%209%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%D0%BA%D0%B0%D1%80%D1%82%20A100%20(80%20%D0%93%D0%91),-.
